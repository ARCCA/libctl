# libctl: flexible Guile-based control files for scientific software
# Copyright (C) 1998 Steven G. Johnson
#
# This file may be used without restriction.  It is in the public
# domain, and is NOT restricted by the terms of any GNU license.
#
# This library is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Library General Public License for more details.
#
# Steven G. Johnson can be contacted at stevenj@alum.mit.edu.

##############################################################################

# Makefile.in for programs using libctl (assumes that autoconf is
# being used, of course).  You should only need to change the definitions
# in this section of the file.

SPECIFICATION_FILE = photonic-crystal.scm
PROGRAM_NAME = example

# objects for program sources:
OBJECTS = example.o \
	  geom.o     # since we use the geom.scm utilities

HEADERS =            # any extra header files you are dependent on

MY_LIBS    =         # extra libs you need go here
MY_LDFLAGS =         # extra -L flags go here
MY_INCLUDES =        # extra -I include flags go here
MY_DEFS =            # extra -D define flags go here

# The following variables should be detected and set by autoconf:

# libctl install. dir., e.g. /usr/local/share/libctl
LIBCTL_DIR = @LIBCTL_DIR@

# gen-ctl-io program
GEN_CTL_IO = @GEN_CTL_IO@

##############################################################################
#                  don't (normally) edit past here                           #
##############################################################################

CTL_DEFS = -DCTL_SCM='"'$(LIBCTL_DIR)/base/ctl.scm'"' \
       -DINCLUDE_SCM='"'$(LIBCTL_DIR)/base/include.scm'"' \
          -DSPEC_SCM='"'`pwd`/$(SPECIFICATION_FILE)'"'

##############################################################################

CC = @CC@
CFLAGS = @CFLAGS@
INCLUDES = @INCLUDES@ -I. $(MY_INCLUDES)
DEFS = @DEFS@ $(CTL_DEFS) $(MY_DEFS)

##############################################################################

LIBS = $(MY_LIBS) @LIBS@
LDFLAGS = $(MY_LDFLAGS) @LDFLAGS@

##############################################################################

INSTALL = @INSTALL@
prefix = @prefix@
@SET_MAKE@

##############################################################################

ALL_OBJECTS = main.o ctl-io.o $(OBJECTS)

all: $(PROGRAM_NAME)

ctl-io.c ctl-io.h: $(SPECIFICATION_FILE)
	$(GEN_CTL_IO) $(SPECIFICATION_FILE) $(LIBCTL_DIR)

$(PROGRAM_NAME): $(ALL_OBJECTS) 
	$(CC) $(LDFLAGS) $(CFLAGS) $(ALL_OBJECTS) $(LIBS) -o $@

main.c: $(LIBCTL_DIR)/base/main.c
	cp -f $(LIBCTL_DIR)/base/main.c $@

geom.c: $(LIBCTL_DIR)/utils/geom.c
	cp -f $(LIBCTL_DIR)/utils/geom.c $@

.c.o: $(HEADERS) ctl-io.h
	$(CC) -c $(DEFS) $(INCLUDES) $(CFLAGS) $< -o $@

install: $(PROGRAM_NAME)
	$(INSTALL) -d $(prefix)/bin
	$(INSTALL) -m 0755 -s $(PROGRAM_NAME) $(prefix)/bin

clean:
	rm -f $(ALL_OBJECTS) ctl-io.c ctl-io.h main.c geom.c \
              $(PROGRAM_NAME) core
